<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!--choix de l'encodage des caractères-->
        <meta charset="utf-8">
        <!--titre de la page internet-->
        <title>exploitWeb</title>
        <!--icone à coté du titre-->
        <link rel="icon" href="assets/iconeMedecin.png">
        <!--liaison avec le fichier css et bootstrap css-->
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/exploitWeb.css">
        <!--liaison avec bootstrap js-->
        <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>-->
        <script src="js/popper.min.js"></script>
        <!--liaison avec fichier javaScript-->
        <script type="text/javascript" src="js/exploitWeb.js"></script>
        <!--liaison avec ajax/JQuery-->
        <script src="js/jquery-3.6.0.min.js"></script>
    </head>
    <body>
        <script> 
        // Refresh le tableauRecherche
        setInterval(function reload(){$("#tableauRecherche").load("php/tableauRecherche.php")}, 5000);
        </script>
        <?php
        session_cache_limiter('private_no_expire, must-revalidate');
        //on demmare la session
        session_start();

        //si les valeurs sont rentrées
        if (isset($_SESSION['login']) && isset($_SESSION['password'])){
            //initialisation des variable pour la bdd
            include("php/connexionBDD.php");
        ?>
        <!--bar de navigation-->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo03" aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <span class="navbar-brand primary">CULM</span>
                <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
                    <ul class="navbar-nav mb-2 mb-lg-0">
                        <li class="nav-item">
                            <span class="nav-link" aria-current="page">
                            <?php
                            //on affiche le nom du formateur
                            echo($_SESSION['login']);
                            ?></span>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="php/deconnexion.php">Déconnexion</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <!--recherche et téléchargement-->
        <form method="POST" action="exploitWeb.php" id="rechercheForm" name="rechercheForm">
            <div class="row">
                <div class="h-100 col-lg-4 col-md-7 col-sm-7 col-10 mt-5 pb-5 pt-5 container bg-light border border-primary rounded">
                    <div class="input-group">
                        <button class="btn btn-primary" type="button" id="button-addon1" onClick="formRecherche()">Rechercher</button>
                        <input type="text" class="form-control" placeholder="Nom" name="rechercheNom" id="rechercheNom" value="<?php echo($_POST['rechercheNom']); ?>">
                    </div>
                    <div class="input-group mb-4">
                        <span class="input-group-text">Options</span>
                        <?php
                        $opt1 = "Ordre alphabétique croissant";
                        $opt2 = "Ordre alphabétique décroissant";
                        $opt3 = "Date croissante";
                        $opt4 = "Date décroissante";
                        ?>
                        <select class="w-50 form-select" name="rechercheSelect" id="rechercheSelect">
                            <option value=<?php echo('"'.$opt1.'"'); if($_POST['rechercheSelect'] == $opt1){echo(" selected");} ?>><?php echo($opt1); ?></option>
                            <option value=<?php echo('"'.$opt2.'"'); if($_POST['rechercheSelect'] == $opt2){echo(" selected");} ?>><?php echo($opt2); ?></option>
                            <option value=<?php echo('"'.$opt3.'"'); if($_POST['rechercheSelect'] == $opt3){echo(" selected");} ?>><?php echo($opt3); ?></option>
                            <option value=<?php echo('"'.$opt4.'"'); if($_POST['rechercheSelect'] == $opt4){echo(" selected");} ?>><?php echo($opt4); ?></option>
                        </select>
                    </div>
                <input type="hidden" id="formatForm" name="formatForm">
                <input type="hidden" id="choixBoxesForm" name="choixBoxesForm">
        </form>
        <form name="formTelechargement" method="POST" action="php/telechargementPDF.php">
                <div class="input-group mb-3">
                    <button class="btn btn-primary" type="submit">Télécharger</button>
                    <div class="btn-group">
                        <input id="formatPDF" onClick="choixFormat()" type="radio" class="btn-check" name="format" checked/>
                        <label class="btn btn-outline-secondary" for="formatPDF">PDF</label>
                        <input <?php echo($_POST['formatForm']); ?> name="format" id="formatCSV" onClick="choixFormat()" type="radio" class="btn-check" />
                        <label class="btn btn-outline-secondary" for="formatCSV">CSV</label>
                    </div>
                </div>
                <div class="input-group " id="logos">
                    <img style="width:30%; height:30%" src="assets/Logo_STJO.png">
                    <img style="width:30%; height:30%" src="assets/Logo_IFSI.png">
                </div>
            </div>
            <!--tableau-->
            <div class="col-lg-7 col-md-10 col-11 mt-5 container" style="overflow:scroll;" id="tableauRecherche">
                <?php
                //affichage du tableau de la recherche
                $_SESSION['rechercheNom'] = $_POST['rechercheNom'];
                $_SESSION['rechercheSelect'] = $_POST['rechercheSelect'];
                include("php/tableauRecherche.php");
                ?>
            </div>
        </form>
        <?php
        }
        else{
            //sinon on redirige vers la page de connexion
            header('Location: exploitWebSession.php');
        }
        ?>
    </body>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
</html>