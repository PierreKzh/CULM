<?php
//début de la session, récupération des infos
session_start();
if (isset($_SESSION['login']) && isset($_SESSION['password'])){
  //compteur
  $nbMax = $_SESSION['compteur'];
  $checkbox = $_SESSION['checkbox'];
  $testBox = 0;
  $tabEtudiant = array('nom', 'prenom', 'date_n', 'code', 'date', 'justification', 'fautes');

  function affichage($tabEtudiant, $i){
    //fonction qui affiche toute une ligne d'un étudiant
    foreach($tabEtudiant as $aspect){
      echo('<td style="width:15%; text-align: center; border-left: none; border-right: none; border-top: none;">'.$_SESSION[$aspect.$i].'</td>');
    }
  }

  ob_start();
?>

<style type="text/css">
  table{width:100%;}
</style>
<!--affichage de l'en tête-->
<page backtop="20mm" backleft="0mm" backright="11mm" backbottom="30mm">
  <page_header>
    <table border="1">
      <tr>
        <td style="width:33%; text-align: center; font-size: 11px;">IFSI</td>
        <td style="width:33%; text-align: center"><strong>CULM</strong></td>
        <td style="width:33%; text-align: center; font-size: 11px;">Résultats examens</td>
      </tr>
    </table>
  </page_header>
<!--corps de la page avec le tableau-->
  <table border="1">
    <tr>
      <th style="width:15%; text-align: center;">Nom</th>
      <th style="width:15%; text-align: center;">Prenom</th>
      <th style="width:15%; text-align: center;">DateNaissance</th>
      <th style="width:15%; text-align: center;">Code</th>
      <th style="width:15%; text-align: center;">Date&Heure</th>
      <th style="width:15%; text-align: center;">Argumentation</th>
      <th style="width:15%; text-align: center;">Erreur</th>
    </tr>

  <?php
  //affichage des informations étudiants
  for($i=1; $i<=$nbMax; $i++){
    echo('<tr>');
    //on vérifie si l'étudiant est coché
    if($checkbox[$i-1] == 1){
      //puis on l'affiche
      affichage($tabEtudiant, $i);
      $testBox++;
    }
    echo('</tr>');
  }
  //si aucun étudiants na été coché
  if($testBox == 0){
    //on affiche tout
    for($i=1; $i<=$nbMax; $i++){
      echo('<tr>');
      affichage($tabEtudiant, $i);
      echo('</tr>');
    }
  }
  ?>

  </table>
<!--pied de page-->
  <page_footer>
    <table border="1">
      <tr>
        <td style="width:33%; text-align: center; font-size: 11px;"><?php echo(date("d/m/y")) ?></td>
        <td style="width:33%; text-align: center"><strong>CULM</strong></td>
        <td style="width:33%; text-align: center; font-size: 11px;"><?php echo($_SESSION['login']) ?></td>
      </tr>
    </table>
  </page_footer>
</page>
<?php
//fermeture de la variable
$content = ob_get_clean();
//récupération de la classe html2pdf
require('html2pdf-4.4.0/html2pdf.class.php');
//création du pdf
try{
  $pdf = new HTML2PDF('P','A4','fr');
  $pdf->pdf->SetDisplayMode('fullpage');
  $pdf->writeHTML($content);
  $pdf->Output('CULM_resultats.pdf', 'D');
}
catch(HTML2PDF_exception $e){
  die($e);
}
}
//si session non connnecté direction page connexion
else{
  header('Location: ../exploitWebSession.php');
}
?>